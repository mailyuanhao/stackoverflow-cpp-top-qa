# C++ 代码中添加 extern "C" 究竟有什么作用？

## 回答

extern “C” 使 C++ 代码中的函数名用于 C 语言链接性 （编译器不再进行名字撕裂 mangle），这样 C 代码就可以通过一个只包含函数声明的 C 语言兼容的头文件来链接（使用）你的函数了。 C 语言链接器可以直接使用 “C” 语言 名字来链接通过 C++ 编译器 编译生成的 二进制格式的函数定义。

相对于 C 语言来说 C++ 支持函数重载， 所以 C++ 编译器不能只用函数名来作为函数的唯一标识。为了支持重载 C++ 编译器 在函数名上增加了所有参数的信息。而 C 编译器则不必这么做。当你标示一个函数拥有 “C” 链接性时， 编译器就不再对该函数名进行撕裂（不再添加参数类型信息了）。

就如你所知，你既可以单独给每一个声明，定义单独指定 C 链接性，也可以给一组声明，定义同时指定

```C++
extern "C" void foo(int);
extern "C"
{
   void g(char);
   int i;
}
```

如果你想了解技术细节，相关内容被定义在 C++03 标准的 第7.5节。下面是摘要

- extern ”C“ 是 链接指定 （linkage—specification）的一种
- 所有的编译器都被要求实现 C 语言链接性 （C 语言指定）
- 链接指定只能出现在命名空间作用域
- 被指定为外部（external）链接性的方法和变量可以拥有语言指定
- 两个方法类型只要语言指定不同，即使其它都一样也是不同的类型
- 链接指定可以被嵌套，最内层的指定为最终有效的指定
- 类成员会忽略 extern ”C“ 指定
- 不管命名空间，拥有相同名字的函数仅允许一个拥有 C 语言链接指定
- 在 extern ”C“ 内再使用 static 指定是没问题的。但是一个实体一旦被指定为内部链接性，就不会再拥有语言指定了（个人理解和嵌套一个意思，内层生效）
- 能否从 C++ 链接别的语言定义的对象或者反过来 是由具体的实现和语言 决定的。仅在两种语言使用的对象布局策略足够相似才能进行这种链接

[参考](https://zh.cppreference.com/w/cpp/language/language_linkage)
